<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Notification - CivicEvents+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
</head>
<body class="bg-gray-50">
    <script>
        $(document).ready(function() {
            if (!requireAdmin()) return;
            loadNavigation();
            loadFooter();
        });

        async function sendNotification(event) {
            event.preventDefault();
            const submitBtn = $(event.target).find('button[type="submit"]');
            submitBtn.prop('disabled', true).text('Sending...');

            const payload = {
                title: $('#title').val(),
                message: $('#message').val(),
                type: $('#type').val(),
                recipient_id: null // Null means broadcast to all users
            };

            try {
                await apiRequest('/notifications', {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                showToast('Broadcast sent successfully!', 'success');
                setTimeout(() => window.location.href = 'admin-dashboard.html', 1500);
            } catch (error) {
                showToast(error.message || 'Failed to send', 'error');
                submitBtn.prop('disabled', false).text('Send Broadcast');
            }
        }
    </script>

    <div class="min-h-screen">
        <main class="max-w-3xl mx-auto px-4 py-8">
            <div class="mb-8"><h1 class="text-3xl font-bold text-gray-900">Send Broadcast</h1></div>
            <div class="bg-white rounded-lg shadow-lg p-8">
                <form onsubmit="sendNotification(event)">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                            <input type="text" id="title" required class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Message</label>
                            <textarea id="message" rows="4" required class="w-full px-4 py-2 border rounded-lg"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                            <select id="type" class="w-full px-4 py-2 border rounded-lg">
                                <option value="system">System Alert</option>
                                <option value="info">General Info</option>
                                <option value="event">Event Update</option>
                            </select>
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Send Broadcast</button>
                            <a href="admin-dashboard.html" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg">Cancel</a>
                        </div>
                    </div>
                </form>
            </div>
        </main>
    </div>
</body>
</html>